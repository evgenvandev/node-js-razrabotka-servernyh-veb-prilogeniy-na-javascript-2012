<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Хэррон Дэвид">
<title>Node.js Разработка серверных веб-приложений на JavaScript</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Node.js Разработка серверных веб-приложений на JavaScript</h1>
<div class="details">
<span id="author" class="author">Хэррон Дэвид</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Оглавление</div>
<ul class="sectlevel1">
<li><a href="#about-of-author">Об Авторе</a></li>
<li><a href="#ch01-what-is-node">Глава 1. Что такое Node?</a>
<ul class="sectlevel2">
<li><a href="#what-allows-to-do-node">Что позволяет делать Node?</a></li>
</ul>
</li>
<li><a href="#ch06-storage-and-select-data">Глава 6. Хранение и выборка данных</a>
<ul class="sectlevel2">
<li><a href="#engines-storage-data-for-node">Движки сохранения данных для Node</a></li>
<li><a href="#sqlite3-lightweight-embedded-database-on-base-sql"><code>SQLite3</code> - облегчённая встраиваемая база данных на основе SQL</a></li>
<li><a href="#install-module-sqlite3-for-node">Установка модуля <code>SQLite3</code></a></li>
<li><a href="#implementation-application-notes-using-sqlite3">Реализация приложения <code>Notes</code> с помощью <code>SQLite3</code></a>
<ul class="sectlevel3">
<li><a href="#_listing_notesdb-sqlite3.js"><code>notesdb-sqlite3.js</code> - модуль абстрагирования базы данных</a></li>
<li><a href="#_listing_setup.js">Инициализация базы данных - <code>setup.js</code></a></li>
<li><a href="#_listing_show.js">Отображение заметок на консоли - <code>show.js</code></a></li>
<li><a href="#_собираем_приложение_notes_воедино_app_js">Собираем приложение <code>Notes</code> воедино - <code>app.js</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#ch01-getting-started">Начало работы с PHP</a>
<ul class="sectlevel2">
<li><a href="#_interpreter_mode">Режим интерпретатора</a></li>
<li><a href="#_server_mode">Режим сервера</a></li>
</ul>
</li>
<li><a href="#function-of-php">Функции PHP</a>
<ul class="sectlevel2">
<li><a href="#_echo_function">Функция echo()</a></li>
<li><a href="#_print_function">Функция print()</a>
<ul class="sectlevel3">
<li><a href="#_особенности_использования_функции_print">Особенности использования функции <code>print()</code>:</a></li>
<li><a href="#_примеры_print">Примеры <code>print()</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="about-of-author">Об Авторе</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>Дэвид Хэррон</strong> вот уже больше 20 лет занимается созданием программного обеспечения, работая
в Кремниевой долине в роли разработчика и инженера по контролю качества. Его последнее место
работы - архитектор по организации контроля качества в компании Yahoo!, где ведутся работы по
созданию новой платформы для веб-приложений на основе Node.</p>
</div>
<div class="paragraph">
<p>В компании Sun Microsystems Дэвид занимал должность архитектора по организации контроля
качества Java SE и работал главным образом над средствами автоматизации тестирования, в том
числе написанным на базе AWT классом Robot, который ныне широко применяется в программах
автоматизации тестирования гафического интерфейса пользователя (ГИП).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch01-what-is-node">Глава 1. Что такое Node?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Node - это захватывающая новая платформа для разработки веб-приложений,
серверов приложений, произвольных сетевых серверов и клиентов, да и вообще
для программирования. Она спроектирована так, чтобы обеспечить высочайшую
масштабируемость сетевых приложений - за счёт хитроумного сочетания
асинхронного ввода/вывода, использования JavaScript на стороне сервера,
изобретательного использования анонимных функций JavaScript и однопоточной
событийно-ориентированной архитектуры.</p>
</div>
<div class="paragraph">
<p>Принятая в Node модель принципиально отличается от распространённых платформ
для построения серверов приложений, в которых масштабируемость достигается
за счёт многопоточности. Утверждается, что благодаря событийно-ориентированной
архитектуре снижается потребление памяти, повышается пропускная способность
и упрощается модель программирования. Сейчас платформа Node быстро развивается,
и многие считают её привлекательной альтернативой традиционному подходу к
разработке веб-приложений - на базе Apache, PHP, Python и т.п.</p>
</div>
<div class="paragraph">
<p>В основе Node лежит автономная виртуальная машина JavaScript с расширениями,
делающими её пригодной для программирования общего назначения с упором на
разработку серверов приложений. Платформу Node не имеет смысла напрямую
сравнивать ни с языками программирования, которые обычно используются
для создания веб-приложений (PHP/Python/Ruby/Java и прочие), ни с
контейнерами, реализующими протокол HTTP (Apache/Tomcat/Glassfish и т.д.).
В то же время многие считают, что потенциально она может заменить
традиционные стеки веб-приложений.</p>
</div>
<div class="paragraph">
<p>В основе реализации лежит цикл обработки событий неблокирующего ввода/вывода
и библиотеки файлового и сетевого ввода/вывода, причём всё это построено
поверх движка V8 JavaScript (заимствованного из веб-браузера Chrome).
Библиотека ввода/вывода обладает достаточной общностью для реализации любого
протокола на базе TCP или UDP: DNS, HTTP, IRC, FTP и др. Но хотя она
поддерживает разработку серверов и клиентов произвольного протокола, чаще
всего применяется для создания обычных веб-сайтов, где заменяет Apache/PHP
или Rails.</p>
</div>
<div class="paragraph">
<p>Эта книга представляет собой введение в платформу Node. Мы предполагаем,
что вы уже умеете писать программы, знакомы с языком JavaScript и знаете,
как разрабатываются веб-приложения на других языках. Мы напишем несколько
работоспособных приложений и убедимся, что учиться лучше всего, копаясь
в коде.</p>
</div>
<div class="sect2">
<h3 id="what-allows-to-do-node">Что позволяет делать Node?</h3>
<div class="paragraph">
<p>Node - платформа для написания JavaScript-приложений вне веб-браузера. Это не
тот JavaScript, с которым все мы знакомы по опыту работы с браузерами. В Node
не встроена ни объектная модель документа (DOM), ни какие-либо ещё
возможности браузера. Именно язык JavaScript в сочетании с асинхронным
вводом/выводом делает Node мощной платформой для разработки приложений.</p>
</div>
<div class="paragraph">
<p>Но вот для чего Node непригодна, так это для разработки персональных
приложений с графическим интерфейсом пользователя (ГИП). На сегодняшний
день в Node нет встроенного эквивалента <code>Swing</code> (или <code>SWT</code>, если вам больше
нравится эта библиотека). Нет и подключаемой библиотеки ГИП для Node, и
внедрить Node в браузер тоже нельзя. Если бы для Node существовала библиотека
ГИП, то на этой платформе можно было строить и персональные приложения.
Недавно появилось несколько проектов по созданию интерфейса между Node и GTK,
итогом которых должна стать кросс-платформенная библиотека ГИП. В состав
движка V8, используемого в Node, входят API-расширения, позволяющие писать
на C/C++ код для расширения JavaScript или интеграции движка с платформенными
библиотеками.</p>
</div>
<div class="paragraph">
<p>Помимо встроенного умения исполнять код на JavaScript, включённые в состав
дистрибутива модули предоставляют и другие возможности:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>утилиты командной строки (для включения в скрипты оболочки);</p>
</li>
<li>
<p>средства написания интерактивных консольных программ (цикл "чтение -
выполнение - печать");</p>
</li>
<li>
<p>великолепные функции управления процессами для наблюдения за дочерними
процессами;</p>
</li>
<li>
<p>объект <code>Buffer</code>, для работы с двоичными данными;</p>
</li>
<li>
<p>механизм для работы с сокетами TCP и UDP с полным комплектом обратных
вызовов в ответ на события;</p>
</li>
<li>
<p>поиск в системе DNS;</p>
</li>
<li>
<p>средства для создания серверов и клиентов протоколов HTTP и HTTPS,
построенные на основе библиотеки TCP-сокетов;</p>
</li>
<li>
<p>средства доступа к файловой системе;</p>
</li>
<li>
<p>встроенная рудиментарная поддержка автономного тестирования с помощью
утверждений.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch06-storage-and-select-data">Глава 6. Хранение и выборка данных</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В завершение книги мы рассмотрим имеющиеся в Node методы хранения данных.
Каким бы мощным ни был веб-каркас Express, без умения сохранять данные от
него мало толку. Обычно данные сохраняют в какой-нибудь базе данных.
Сегодня имеются технологии баз данных на самые разные случаи - традиционные
хранилища на основе SQL, документо-ориентированные базы данных без использования SQL,
простые хранилища ключей и значений или веб-службы запросов типа YQL.</p>
</div>
<div class="paragraph">
<p>В этой главе мы напишем два варианта простого веб-приложения <em>Notes</em>. На его
примере мы продемонстрируем основы CRUD (Create, Read, Update, Delete -
создание, чтение, обновление, удаление), используя Node-модули для работы с SQL и MongoDB.</p>
</div>
<div class="sect2">
<h3 id="engines-storage-data-for-node">Движки сохранения данных для Node</h3>
<div class="paragraph">
<p>В Node не предусмотрена встроенная поддержка какой-нибудь системы хранения данных,
если не считать чтение и запись в файловую систему. Для работы с системами хранения,
в частности с базами данных, необходимо использовать соответствующий модуль. На вики-сайте
Node перечислено два десятка таких модулей для работы с CouchDB, MongoDB, MySQL, Postgres,
SQLite3, Memcache, REDIS, YQL и другими системами. Смотрите <a href="https://github.com/joyent/node/wiki/modules#database" class="bare" target="_blank" rel="noopener">https://github.com/joyent/node/wiki/modules#database</a>.</p>
</div>
<div class="paragraph">
<p>В общем случае необходимо установить как сам модуль, так и его зависимости, в том числе
платформенный код клиентских библиотек конкретной СУБД. Например, модулям для работы с MySQL
необходимы сервер MySQL и соответствующая клиентская библиотека.</p>
</div>
</div>
<div class="sect2">
<h3 id="sqlite3-lightweight-embedded-database-on-base-sql"><code>SQLite3</code> - облегчённая встраиваемая база данных на основе SQL</h3>
<div class="paragraph">
<p>СУБД на основе SQL необязательно подразумевает наличие тяжеловесного сервера и высокооплачиваемых
администраторов баз данных. Установить SQLite3 (<a href="http://www.sqlite.org" class="bare" target="_blank" rel="noopener">http://www.sqlite.org</a>) очень
просто - это всего лишь автономная библиотека, компонуемая вместе с приложением, она не нуждается
ни в сервере, ни в настройке и тем не менее обеспечивает полноценную работу с SQL. В проекте <strong>node-sqlite3</strong>
(<a href="https://github.com/developmentseed/node-sqlite3" class="bare" target="_blank" rel="noopener">https://github.com/developmentseed/node-sqlite3</a>) реализован интерфейс между SQLite3 и Node.</p>
</div>
</div>
<div class="sect2">
<h3 id="install-module-sqlite3-for-node">Установка модуля <code>SQLite3</code></h3>
<div class="paragraph">
<p>Если имеется менеджер пакетов <code>npm</code>, то установка модуля не вызывает ни малейших сложностей:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">npm install sqlite3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Для установки этого модуля необходимо, чтобы в системе уже были установлены библиотека <code>sqlite3</code> и
npm-модуль, содержаший платформенный (написанный на <code>C</code>) код, реализующий интерфейс с этой библиотекой.
Библиотека по умолчанию присутствует в Mac OS X, а если в вашем любимом дистрибутиве Linux её нет,
то достаточно воспользоваться менеджером пакетов (например, <code>apt-get install libsqlite3</code>). На сайте <code>sqlite3</code>
(<a href="http://sqlite.org" class="bare" target="_blank" rel="noopener">http://sqlite.org</a>) имеется документация по использованию этой базы данных, командным
утилитам для работы с ней и с API.</p>
</div>
</div>
<div class="sect2">
<h3 id="implementation-application-notes-using-sqlite3">Реализация приложения <code>Notes</code> с помощью <code>SQLite3</code></h3>
<div class="paragraph">
<p>Чтобы научиться работать с <code>sqlite3</code>, мы напишем простое приложение для ввода
и отображения заметок. Впоследствии мы модифицируем его под <code>MongoDB</code>.</p>
</div>
<div class="paragraph">
<p>Поскольку <code>SQLite3</code> основана на SQL, то схема базы данных <code>Notes</code> описывается
на языке SQL. Команда <code>CREATE TABLE</code> в файле <code>notesdb-sqlite3.js</code>, который
рассматривается в следующем разделе, выглядит так:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">notes</span> <span class="p">(</span>
  <span class="n">ts</span> <span class="nb">DATETIME</span><span class="p">,</span>
  <span class="n">author</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="n">note</span> <span class="nb">TEXT</span>
<span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>В поле <code>ts</code> находится временная метка, идентифицирующая заметку, в поле <code>author</code> -
имя автора заметки, а в поле <code>note</code> - её текст.
</p>
</div>
<div class="sect3">
<h4 id="_listing_notesdb-sqlite3.js"><code>notesdb-sqlite3.js</code> - модуль абстрагирования базы данных</h4>
<div class="paragraph">
<p>Это библиотека интерфейса с базой данных, которая скрывает команды SQL в одном модуле и
используется во всех остальных частях приложения. Она реализует четыре столпа <code>CRUD</code> с
помощью функций <code>add</code> (создание), <code>findNoteById</code> (чтение), <code>edit</code> (обновление) и <code>delete</code> (удаление).</p>
</div>
<div class="paragraph">
<p>Задача этого модуля - инкапсулировать обращения к <code>SQLite3</code>, изолировав их от прочих частей приложения <code>Notes</code>.
Модуль предоставляет несколько функций для создания базы данных, добавления записей в таблицу,
выборки всех строк из таблицы и удаления записей. Это позволяет сделать шаг в направлении архитектуры
<em>модель-представление-контроллер</em>:</p>
</div>
<div class="listingblock">
<div class="title">Часть файла <em>notesdb-sqlite3.js</em></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sqlite3</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">sqlite3</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">sqlite3</span><span class="p">.</span><span class="nf">verbose</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">connect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sqlite3</span><span class="p">.</span><span class="nc">Database</span><span class="p">(</span><span class="dl">"</span><span class="s2">chap06.sqlite3</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">sqlite3</span><span class="p">.</span><span class="nx">OPEN_READWRITE</span> <span class="o">|</span> <span class="nx">sqlite3</span><span class="p">.</span><span class="nx">OPEN_CREATE</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL on creating database </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">disconnect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">setup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">"</span><span class="s2">CREATE TABLE IF NOT EXISTS notes </span><span class="dl">"</span> <span class="o">+</span>
    <span class="dl">"</span><span class="s2">(ts DATETIME, author VARCHAR(255), note TEXT)</span><span class="dl">"</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL on creating table </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Это служебный код, в котором мы подгружаем необходимые модули и определяем
функции для открытия и закрытия базы данных, а также для создания таблицы.
Мы жёстко зашили в код имя базы данных, поэтому при вызове функций <code>connect</code>
и <code>setup</code> в текущем каталоге создаётся файл <code>chap06.sqlite3</code>, если его ещё не
существует.</p>
</div>
<div class="paragraph">
<p>Этот модуль раскрывает точно такой же API, как модуль <code>notesdb-mongoose.js</code>
для работы с базой данных <code>MongoDB</code>, который мы рассмотрим ниже. Правда,
здесь функция <code>disconnect</code> по существу ничего не делает, тогда как в модуле
<code>notesdb-mongoose.js</code> она действительно разрывает соединение с базой данных.</p>
</div>
<div class="listingblock">
<div class="title">Часть файла <em>notesdb-sqlite3.js</em></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">emptyNote</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span> <span class="na">author</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span> <span class="na">note</span><span class="p">:</span> <span class="dl">""</span><span class="p">};</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">author</span><span class="p">,</span> <span class="nx">note</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">"</span><span class="s2">INSERT INTO notes (ts, author, note) </span><span class="dl">"</span> <span class="o">+</span>
    <span class="dl">"</span><span class="s2">VALUES (?, ?, ?);</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">[</span><span class="k">new</span> <span class="nc">Date</span><span class="p">(),</span> <span class="nx">author</span><span class="p">,</span> <span class="nx">note</span><span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL to add </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Функция <code>add</code> добавляет в базу данных новую запись, это прямое обращение к SQL.</p>
</div>
<div class="paragraph">
<p>В случае <code>SQLite3</code> функция <code>run</code> принимает параметризованную строку, в которой могут быть
маркеры в виде вопросительных знаков. При вызове функции передаётся массив значений, подставляемых
вместо маркеров. Такой подход к реализации команд SQL принят во всех языках программирования. В
<code>SQLite3</code> предполагается, что каждому вопросительному знаку соответствует свой элемент массива.
Интерфейсная библиотека берёт на себя заботу о корректном экранировании значений, подставляемых
в SQL-команду.</p>
</div>
<div class="paragraph">
<p>Обратите внимание, что вызывающая программа предоставляет функцию обратного вызова, с помощью
которой передаётся информация об ошибках. Модели неизвестно, как показывать эту информацию пользователю;
она полагает, что вызывающей функции лучше знать, что делать с ошибками.</p>
</div>
<div class="listingblock">
<div class="title">Часть файла <em>notesdb-sqlite3.js</em></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="k">delete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ts</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">"</span><span class="s2">DELETE FROM notes WHERE ts = ?;</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">ts</span><span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL to delete </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Функция <code>delete</code> удаляет заметки из базы данных.</p>
</div>
<div class="paragraph">
<p>Обратите внимание, что для идентификации удаляемой заметки используется временная метка, да и вообще
во всём модуле именно так определяется запись, к которой применяется операция. Поле <code>ts</code>
инициализируется в функции <code>add</code>.</p>
</div>
<div class="listingblock">
<div class="title">Часть файла <em>notesdb-sqlite3.js</em></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">edit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ts</span><span class="p">,</span> <span class="nx">author</span><span class="p">,</span> <span class="nx">note</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">"</span><span class="s2">UPDATE notes </span><span class="dl">"</span> <span class="o">+</span>
    <span class="dl">"</span><span class="s2">SET ts = ?, author = ?, note = ? </span><span class="dl">"</span> <span class="o">+</span>
    <span class="dl">"</span><span class="s2">WHERE ts = ?</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">ts</span><span class="p">,</span> <span class="nx">author</span><span class="p">,</span> <span class="nx">note</span><span class="p">,</span> <span class="nx">ts</span><span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL on updating table </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Функция <code>edit</code> позволяет обновить заметку, записав в поля новые значения.
Мы пользуемся SQL-командой <code>UPDATE</code> с параметрами для каждого нового значения
и временной метки, идентифицирующей заметку:</p>
</div>
<div class="listingblock">
<div class="title">Часть файла <em>notesdb-sqlite3.js</em></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">allNotes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1"> in allNote</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">all</span><span class="p">(</span><span class="dl">"</span><span class="s2">SELECT * FROM notes</span><span class="dl">"</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">forAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doEach</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">each</span><span class="p">(</span><span class="dl">"</span><span class="s2">SELECT * FROM notes</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL to retrieve row </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
      <span class="nf">done</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nf">doEach</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">row</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="nx">done</span><span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Функции <code>allNotes</code> и <code>forAll</code> дают два способа работы с множеством всех заметок.
Функция <code>allNotes</code> копирует строки из базы данных в массив. Функции же <code>forAll</code>
передаются две функции обратного вызова: <code>doEach</code>, которая вызывается для каждой строки
в результирующем множестве, и <code>done</code>, которая вызывается после обработки последней строки.</p>
</div>
<div class="paragraph">
<p>Понятно, что <code>allNotes</code> потребляет больше памяти, чем <code>forAll</code>, которая в каждый момент
времени работает всего с одной строкой.</p>
</div>
<div class="listingblock">
<div class="title">Часть файла <em>notesdb-sqlite3.js</em></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="nx">exports</span><span class="p">.</span><span class="nx">findNoteById</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ts</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">didOne</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">each</span><span class="p">(</span><span class="dl">"</span><span class="s2">SELECT * FROM notes WHERE ts = ?</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">ts</span><span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL to retrieve row </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">didOne</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">row</span><span class="p">);</span>
          <span class="nx">didOne</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Функция <code>findNoteById</code> возвращает данные из заметки, идентифицируемой временной меткой.
В базе данных должна быть только одна запись с данной временной меткой, но на случай,
если это вдруг не так, мы завели флаг, гарантирующий, что функция обратного вызова будет
вызвана не более одного раза.</p>
</div>
<details>
<summary class="title">Файл <em>notesdb-sqlite3.js</em></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="c1">// Хэррон Д. Node.js Разработка серверных веб-приложений на JavaScript - 2012</span>
<span class="c1">// Глава-6 Модуль абстрагирования базы данных notesdb-sqlite3.js - Стр. 117</span>
<span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sqlite3</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">sqlite3</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">sqlite3</span><span class="p">.</span><span class="nf">verbose</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>

<span class="c1">// Функция для открытия базы данных.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">connect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sqlite3</span><span class="p">.</span><span class="nc">Database</span><span class="p">(</span><span class="dl">"</span><span class="s2">chap06.sqlite3</span><span class="dl">"</span><span class="p">,</span>
    <span class="nx">sqlite3</span><span class="p">.</span><span class="nx">OPEN_READWRITE</span> <span class="o">|</span> <span class="nx">sqlite3</span><span class="p">.</span><span class="nx">OPEN_CREATE</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL on creating database </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Функция для закрытия базы данных.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">disconnect</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Функция для создания таблицы в базе данных.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">setup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">"</span><span class="s2">CREATE TABLE IF NOT EXISTS notes </span><span class="dl">"</span> <span class="o">+</span>
    <span class="dl">"</span><span class="s2">(ts DATETIME, author VARCHAR(255), note TEXT)</span><span class="dl">"</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL on creating table </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Возвращается пустой объект записи.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">emptyNote</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">ts</span><span class="dl">"</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span> <span class="na">author</span><span class="p">:</span> <span class="dl">""</span><span class="p">,</span> <span class="na">note</span><span class="p">:</span> <span class="dl">""</span><span class="p">};</span>

<span class="c1">// Функция add добавляет в базу данных новую запись.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">add</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">author</span><span class="p">,</span> <span class="nx">note</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">"</span><span class="s2">INSERT INTO notes (ts, author, note) </span><span class="dl">"</span> <span class="o">+</span>
    <span class="dl">"</span><span class="s2">VALUES (?, ?, ?);</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">[</span><span class="k">new</span> <span class="nc">Date</span><span class="p">(),</span> <span class="nx">author</span><span class="p">,</span> <span class="nx">note</span><span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL to add </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Функция delete удаляет заметки из базы данных.</span>
<span class="nx">exports</span><span class="p">.</span><span class="k">delete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ts</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">"</span><span class="s2">DELETE FROM notes WHERE ts = ?;</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">ts</span><span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL to delete </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Функция edit позволяет обновить заметку, записав в поля новые значения.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">edit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ts</span><span class="p">,</span> <span class="nx">author</span><span class="p">,</span> <span class="nx">note</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">"</span><span class="s2">UPDATE notes </span><span class="dl">"</span> <span class="o">+</span>
    <span class="dl">"</span><span class="s2">SET ts = ?, author = ?, note = ? </span><span class="dl">"</span> <span class="o">+</span>
    <span class="dl">"</span><span class="s2">WHERE ts = ?</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">ts</span><span class="p">,</span> <span class="nx">author</span><span class="p">,</span> <span class="nx">note</span><span class="p">,</span> <span class="nx">ts</span><span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL on updating table </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Функции allNotes и forAll дают два способа работы с множеством всех заметок.</span>
<span class="c1">// Функция allNotes копирует строки из базы данных в массив.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">allNotes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1"> in allNote</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">all</span><span class="p">(</span><span class="dl">"</span><span class="s2">SELECT * FROM notes</span><span class="dl">"</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Функции forAll передаются две функции обратного вызова: doEach, которая </span>
<span class="c1">// вызывается для каждой строки в результирующем множестве, и done, которая </span>
<span class="c1">// вызывается после обработки последней строки.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">forAll</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">doEach</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">each</span><span class="p">(</span><span class="dl">"</span><span class="s2">SELECT * FROM notes</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL to retrieve row </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
      <span class="nf">done</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nf">doEach</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">row</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="nx">done</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Функция findNoteById возвращает данные из заметки, идентифицируемой </span>
<span class="c1">// временной меткой.</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">findNoteById</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ts</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">didOne</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="nx">db</span><span class="p">.</span><span class="nf">each</span><span class="p">(</span><span class="dl">"</span><span class="s2">SELECT * FROM notes WHERE ts = ?</span><span class="dl">"</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">ts</span><span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">FAIL to retrieve row </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">err</span><span class="p">);</span>
        <span class="nf">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">didOne</span><span class="p">)</span> <span class="p">{</span>
          <span class="nf">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">row</span><span class="p">);</span>
          <span class="nx">didOne</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p></p>
</div>
</div>
<div class="sect3">
<h4 id="_listing_setup.js">Инициализация базы данных - <code>setup.js</code></h4>
<div class="paragraph">
<p>Node-модуль <code>sqlite3</code> пользуется библиотеками <code>sqlite3</code>, поэтому неудивительно,
что все стандартные инструменты, поставляемые вместе с <code>SQLite3</code>, работают
с базой данных, созданной с помощью <code>node-sqlite3</code>. Например, базу данных
можно создать с помощью утилиты <code>sqlite3</code>, как показано на рисунке ниже:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/setup_database_with_utilite_sqlite3.jpg" alt="setup database with utilite sqlite3">
</div>
<div class="title">Рисунок 1. Инициализация базы данных с помощью утилиты <code>sqlite3</code></div>
</div>
<div class="paragraph">
<p>Но можно вместо этого написать скрипт <code>setup.js</code>, который инициализирует
базу данных точно так же, как это делает модуль <code>notesdb</code>:</p>
</div>
<div class="listingblock">
<div class="title">Файл <em>setup.js</em></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="k">async</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">async</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">notesdb</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./notesdb-sqlite3</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// var notesdb = require('./notesdb-mongoose');</span>

<span class="nx">notesdb</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">notesdb</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
    <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">async</span><span class="p">.</span><span class="nf">series</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">notesdb</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">Lorem Ipsum </span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">Cras metus. Sed aliquet risus a tortor. Integer id quam Morbi ... fermentum non, convallis id, sagittis at, neque.</span><span class="dl">"</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">cb</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">notesdb</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">Lorem Ipsum 2</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla quis sem at nibh elementum imperd iet. Duis sagittis ipsum. Praesent mauris. Fusce nec tellus sed auque semper porta. Mauris massa. Vestibulum lacinia arcu eget nulla. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Curabitur sodales ligula in libero. Sed dignissim lacinia nunc.</span><span class="dl">"</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">cb</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">notesdb</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">Lorem Ipsum 3</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">Curabitur tortor. Pellentesque nibh. Aenean quam. In scelerisque sem at dolor. Maecenas mattis. Sed convallis tristique sem. Proin ut ligula vel nunc egestas porttitor. Morbi lectus risus, iaculis vel, suscipit quis, luctus non, massa. Fusce ac turpis quis ligula lacinia aliquet. Mauris ipsum. Nulla metus metus, ullamcorper vel, tincidunt sed, euism.</span><span class="dl">"</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">cb</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
      <span class="nx">notesdb</span><span class="p">.</span><span class="nf">disconnect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{});</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Обратите внимание, что в коде есть два обращения к функции <code>require</code> для
загрузки двух разных модулей <code>notesdb</code>, но фактически выполняется только
вызов <code>require(./notesdb-sqlite3)</code>. Позже мы воспользуемся этим же скриптом
при работе с модулем <code>Mongoose</code>, а поскольку API одинаковый, то для
переключения с одной СУБД на другую будет достаточно изменить лишь имя модуля.</p>
</div>
<div class="paragraph">
<p>Таким образом, мы заранее заполняем базу данных и можем повторять выполнение
<code>notesdb.add</code> сколько угодно раз. В функцию <code>async.series</code> первым параметром
передаётся массив, содержащий функции, в которых выполняется вызов функции
<code>notesdb.add</code>.</p>
</div>
<div class="paragraph">
<p>Важный момент здесь - точка, в которой
вызывается функция <code>disconnect</code>. Если вызвать её перед завершением всех
операции <code>add</code>, то некоторые останутся невыполненными. Напомним, что эти
функции вызываются асинхронно, поэтому операции могут выполняться не в том
порядке, в котором встречаются в коде.</p>
</div>
<div class="paragraph">
<p>Модуль <code>async</code> применяется для правильной организации последовательности
операции <code>add</code>, за которыми следует <code>disconnect</code>. Обычно обратные вызовы
выполняются в фоновом режиме, и если скрипт сначала несколько раз вызовет
функцию <code>notesdb.add</code>, а потом <code>notesdb.disconnect</code>, то может случиться
так, что операция разрыва соединения завершится до того, как выполнены
все операции добавления. В таких случаях модуль <code>async</code> оказывается очень
полезен. У него много разных возможностей, в частности функция <code>async.series</code>
позволяет выполнять функции строго по порядку, гарантируя, что последняя
будет выполнена по завершении всех, предшествующих ей.</p>
</div>
<div class="paragraph">
<p>Модуль <code>async</code> необходимо импортировать командой:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">npm install async</span></code></pre>
</div>
</div>
<details>
<summary class="title">Файл <em>setup.js</em></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="c1">// Хэррон Д. Node.js Разработка серверных веб-приложений на JavaScript - 2012</span>
<span class="c1">// Глава-6 Инициализация базы данных setup.js - Стр. 120</span>
<span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="k">async</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">async</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">notesdb</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./notesdb-sqlite3</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// var notesdb = require('./notesdb-mongoose');</span>

<span class="nx">notesdb</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">notesdb</span><span class="p">.</span><span class="nf">setup</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
    <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">async</span><span class="p">.</span><span class="nf">series</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">notesdb</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">Lorem Ipsum </span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">Cras metus. Sed aliquet risus a tortor. Integer id quam Morbi ... fermentum non, convallis id, sagittis at, neque.</span><span class="dl">"</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">cb</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span> 
    <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">notesdb</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">Lorem Ipsum 2</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam. Sed nisi. Nulla quis sem at nibh elementum imperd iet. Duis sagittis ipsum. Praesent mauris. Fusce nec tellus sed auque semper porta. Mauris massa. Vestibulum lacinia arcu eget nulla. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Curabitur sodales ligula in libero. Sed dignissim lacinia nunc.</span><span class="dl">"</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">cb</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">},</span> 
    <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">notesdb</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="dl">"</span><span class="s2">Lorem Ipsum 3</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">Curabitur tortor. Pellentesque nibh. Aenean quam. In scelerisque sem at dolor. Maecenas mattis. Sed convallis tristique sem. Proin ut ligula vel nunc egestas porttitor. Morbi lectus risus, iaculis vel, suscipit quis, luctus non, massa. Fusce ac turpis quis ligula lacinia aliquet. Mauris ipsum. Nulla metus metus, ullamcorper vel, tincidunt sed, euism.</span><span class="dl">"</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="nf">cb</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">],</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ERROR </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
      <span class="nx">notesdb</span><span class="p">.</span><span class="nf">disconnect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{});</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">});</span></code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p></p>
</div>
</div>
<div class="sect3">
<h4 id="_listing_show.js">Отображение заметок на консоли - <code>show.js</code></h4>
<div class="paragraph">
<p>Выше мы уже отмечали, что функция <code>notesdb.forAll</code> позволяет выбирать из
базы все заметки. Мы можем воспользоваться ей для распечатки содержимого
базы данных на консоли:</p>
</div>
<div class="listingblock">
<div class="title">Файл <em>show.js</em></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">notesdb</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./notesdb-sqlite3</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// var notesdb = require('./notesdb-mongoose');</span>

<span class="nx">notesdb</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">notesdb</span><span class="p">.</span><span class="nf">forAll</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ROW: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">util</span><span class="p">.</span><span class="nf">inspect</span><span class="p">(</span><span class="nx">row</span><span class="p">));</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ALL DONE</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">notesdb</span><span class="p">.</span><span class="nf">disconnect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{});</span>
<span class="p">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Результат работы этого скрипта показан на рисунке ниже.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/show_all_notes_with_show_js.jpg" alt="show all notes with show js">
</div>
<div class="title">Рисунок 2. Отображение заметок на консоли</div>
</div>
<details>
<summary class="title">Файл <em>show.js</em></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="javascript"><span class="c1">// Хэррон Д. Node.js Разработка серверных веб-приложений на JavaScript - 2012</span>
<span class="c1">// Глава-6 Отображение заметок на консоли show.js - Стр. 121</span>
<span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">util</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">notesdb</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./notesdb-sqlite3</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// var notesdb = require('./notesdb-mongoose');</span>

<span class="nx">notesdb</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">notesdb</span><span class="p">.</span><span class="nf">forAll</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ROW: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">util</span><span class="p">.</span><span class="nf">inspect</span><span class="p">(</span><span class="nx">row</span><span class="p">));</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="nx">util</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ALL DONE</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">notesdb</span><span class="p">.</span><span class="nf">disconnect</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{});</span>
<span class="p">});</span></code></pre>
</div>
</div>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_собираем_приложение_notes_воедино_app_js">Собираем приложение <code>Notes</code> воедино - <code>app.js</code></h4>
<div class="paragraph">
<p>Итак, мы видели, как обращаться к базе данных с помощью модуля
<code>notesdb-sqlite3.js</code>, теперь соберём всё вместе в простое веб-приложение
на основе <code>Express</code>, рассматривая модуль <code>notesdb-sqlite3.js</code> как модель,
а модуль <code>app.js</code> - как контроллер. Для представления используем шаблоны,
с которыми познакомимся чуть ниже. Как и два предыдущих скрипта, <code>show.js</code> и
<code>setup.js</code>, скрипт <code>app.js</code> написан так, чтобы было легко перейти от модуля
<code>notesdb-sqlite3.js</code> к модулю <code>notesdb-mongoose.js</code>:</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch01-getting-started">Начало работы с PHP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Язык PHP используется для создания сайтов и веб-приложений.
Он обладает довольно богатой историей, чрезвычайно популярен среди разработчиков и поддерживается большинством хост-серверов.<br>
У языка PHP есть автор - датский программист <strong>Расмус Лердорф</strong>.
Начинался проект с разработки скриптов для поддержки персональной веб-страницы и имел рабочее название <em>Personal Home Page Tools</em>, или, сокращённо, <em>PHP Tools</em>.
Постепенно всё это трансформировалось в полноценный и эффективный программный продукт.
Сегодня название PHP обычно ассоциируется с фразой <em>Hypertext Preprocessor</em> (букв. "препроцессор гипертекста"), что не далеко от истины.
Язык PHP является скриптовым (сценарным) и интерпретируемым языком.</p>
</div>
<div class="sect2">
<h3 id="_interpreter_mode">Режим интерпретатора</h3>
<div class="paragraph">
<p>Условно можно выделить два режима выполнения программного кода PHP.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Режим интерпретатора - выполнение кода с помощью интерпретатора на компьютере-клиенте.</p>
</li>
<li>
<p>Режим сервера - этот режим связан с инкапсуляцией PHP-кода в документ с HTML-разметкой.<br>
В данном случае необходимо использовать сервер - или внешний, или локальный.<br>
Реализовать это немного сложнее, чем выполнить код с помощью интерпретатора, но такой режим является более "естественным"
и имеет непосредственное отношение к практическому использованию PHP.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_server_mode">Режим сервера</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="function-of-php">Функции PHP</h2>
<div class="sectionbody">
<div class="paragraph">
<p></p>
</div>
<div class="sect2">
<h3 id="_echo_function">Функция echo()</h3>
<div class="paragraph">
<p>Функция <code>echo()</code> предназначена для вывода переменных в окно браузера. Конструкция имеет следующий синтаксис:</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис функции <code>echo()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="n">void</span> <span class="k">echo</span><span class="p">(</span><span class="n">string</span> <span class="nv">$arg1</span> <span class="p">[,</span> <span class="n">string</span> <span class="nv">$arg</span><span class="mf">...</span><span class="p">])</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Может принимать один или более параметров, разделённых запятой, которые она выводит в окно браузера.<br>
Рассмотрим пример, в котором три строки объединялись в одну перед выводом их функцией <code>echo()</code>:</p>
</div>
<div class="listingblock">
<div class="title">Листинг 1. Использование оператора "точка" в функции <code>echo()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
<span class="nv">$number</span> <span class="o">=</span> <span class="mi">216</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">'Сегодня '</span> <span class="mf">.</span> <span class="nv">$number</span> <span class="mf">.</span> <span class="s1">' участников'</span><span class="p">;</span> <span class="c1">// Сегодня 216 участников</span>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Однако эту операцию можно осуществить средствами функции, просто перечислив все параметры через запятую после ключевого слова <code>echo()</code>:</p>
</div>
<div class="listingblock">
<div class="title">Листинг 2. Использование оператора "запятая" в функции <code>echo()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
<span class="nv">$number</span> <span class="o">=</span> <span class="mi">216</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">'Сегодня '</span><span class="p">,</span> <span class="nv">$number</span><span class="p">,</span> <span class="s1">' участников'</span><span class="p">;</span> <span class="c1">// Сегодня 216 участников</span>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Параметры функции <code>echo()</code> могут помещаться в необязательные круглые скобки:</p>
</div>
<div class="listingblock">
<div class="title">Листинг 3. Использование круглых скобок в функции <code>echo()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
<span class="nv">$number</span> <span class="o">=</span> <span class="mi">216</span><span class="p">;</span>
<span class="k">echo</span><span class="p">(</span><span class="s1">'Сегодня '</span><span class="p">,</span> <span class="nv">$number</span><span class="p">,</span> <span class="s1">' участников'</span><span class="p">);</span> <span class="c1">// Сегодня 216 участников</span>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Часто вместо функции <code>echo()</code> используют строковую функцию <code>print()</code> <a href="#_print_function">Функция print()</a>, которая также позволяет выводить переменные в окно браузера.
Однако функция <code>print()</code> принимает только один параметр, поэтому в ней нельзя приводить параметры через запятую.
Кроме того, функция возвращает <code>true</code> в случае успешного вывода переменной, иначе возвращается <code>false</code>.
Функция <code>echo()</code> не возвращает ничего (Листинг 3):</p>
</div>
<div class="listingblock">
<div class="title">Листинг 3. Использование строковой функции <code>print()</code> и функции <code>echo()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
<span class="nv">$number</span> <span class="o">=</span> <span class="mi">216</span><span class="p">;</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'Сегодня '</span> <span class="mf">.</span> <span class="nv">$number</span> <span class="mf">.</span> <span class="s1">' участников'</span><span class="p">);</span> <span class="c1">// Сегодня 216 участников</span>
<span class="k">echo</span> <span class="k">print</span><span class="p">(</span><span class="s1">'Hello, world!'</span><span class="p">);</span> <span class="c1">// Hello, world!</span>
<span class="c1">// print echo "Hello, world!"; // Ошибка</span>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p></p>
</div>
</div>
<div class="sect2">
<h3 id="_print_function">Функция print()</h3>
<div class="paragraph">
<p>Функция <code>print()</code> отображает сообщение, текст которого передан аргументом функции.</p>
</div>
<div class="listingblock">
<div class="title">Синтаксис функции <code>print()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="n">int</span> <span class="k">print</span><span class="p">(</span><span class="nv">$arg</span><span class="p">);</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_особенности_использования_функции_print">Особенности использования функции <code>print()</code>:</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Функция <code>print()</code> принимает только один аргумент, поэтому в ней нельзя приводить аргументы через запятую.</p>
</li>
<li>
<p>Функция возвращает <code>true</code> в случае успешного вывода переменной, иначе возвращается <code>false</code>.</p>
</li>
<li>
<p>Функция <code>print()</code> может использоваться без скобок, так как это не настоящая функция, а конструкция языка.</p>
</li>
<li>
<p>Если стоит выбор между функциями <code>print()</code> и <code>echo()</code>, то лучше использовать <code>echo()</code>, так как она работает немного быстрее.</p>
</li>
<li>
<p>Соединение двух строк происходит при помощи точки ".", знак "+" здесь не используется.</p>
</li>
<li>
<p>Строковое выражение может быть взято как в одинарные, так и в двойные кавычки.
Если используются двойные кавычки, то вместо имён переменных будут подставляться их значения.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Примечание"></i>
</td>
<td class="content">
<div class="paragraph">
<p>На самом деле <code>print()</code> - это не совсем функция, а специальная синтаксическая конструкция языка PHP.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Подсказка"></i>
</td>
<td class="content">
<div class="paragraph">
<p>При вызове функции <code>print()</code> аргумент может быть указан без круглых скобок.
То есть вместо команды <code>print("Hello, PHP!")</code> можно использовать инструкцию <code>print "Hello, PHP!"</code>.
Альтернативой функции <code>print()</code> является инструкция <code>echo()</code> <a href="#_echo_function">Функция echo()</a>.
Соответственно, для отображения нашего сообщения можно было бы использовать команду <code>echo "Hello, PHP!"</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_примеры_print">Примеры <code>print()</code></h4>
<div class="paragraph">
<p>Просто выводим строку текста:</p>
</div>
<div class="listingblock">
<div class="title">Листинг 1. Вывод строки текста функцией <code>print()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"Hello, PHP!"</span><span class="p">);</span>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Результат выполнения (Листинг 1. Вывод строки текста функцией <code>print()</code>)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">Hello, PHP!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Символ новой строки не добавляется:</p>
</div>
<div class="listingblock">
<div class="title">Листинг 2. Вывод строки текста, без символа новой строки, функцией <code>print()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"Hello, "</span><span class="p">);</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"PHP!"</span><span class="p">);</span>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Результат выполнения (Листинг 2. Вывод строки текста, без символа новой строки, функцией <code>print()</code>)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">Hello, PHP!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Добавляем символ новой строки <code>\n</code> в саму выводимую строку:</p>
</div>
<div class="listingblock">
<div class="title">Листинг 3. Вывод строки текста, с символом новой строки, функцией <code>print()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"Hello, </span><span class="se">\n</span><span class="s2">PHP!"</span><span class="p">);</span>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Результат выполнения (Листинг 3. Вывод строки текста, с символом новой строки, функцией <code>print()</code>)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">Hello,
PHP!</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Аргументом может быть любое выражение, преобразуемое в строку:</p>
</div>
<div class="listingblock">
<div class="title">Листинг 4. Вывод значения переменной в текстовой строке функцией <code>print()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
  <span class="nv">$example</span> <span class="o">=</span> <span class="s2">"пример"</span><span class="p">;</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"Пример - это </span><span class="nv">$example</span><span class="s2">"</span><span class="p">);</span>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Результат выполнения (Листинг 4. Вывод значения переменной в текстовой строке функцией <code>print()</code>)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">Пример - это пример</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Вывод значения элементов массива:</p>
</div>
<div class="listingblock">
<div class="title">Листинг 5. Вывод значения элементов массива функцией <code>print()</code></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="php"><span class="o">&lt;?</span><span class="n">php</span>
  <span class="nv">$fruits</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"лимон"</span><span class="p">,</span> <span class="s2">"апельсин"</span><span class="p">,</span> <span class="s2">"банан"</span><span class="p">];</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"Первый элемент - "</span> <span class="mf">.</span> <span class="nv">$fruits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="mf">.</span>
        <span class="s2">"Второй элемент - "</span> <span class="mf">.</span> <span class="nv">$fruits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="mf">.</span>
        <span class="s2">"Третий элемент - "</span> <span class="mf">.</span> <span class="nv">$fruits</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="cp">?&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Результат выполнения (Листинг 5. Вывод значения элементов массива функцией <code>print()</code>)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">Первый элемент - лимон
Второй элемент - апельсин
Третий элемент - банан</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>